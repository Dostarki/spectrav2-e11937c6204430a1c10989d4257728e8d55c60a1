"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isValidSolanaAddress = isValidSolanaAddress;
exports.validateSolanaAddress = validateSolanaAddress;
exports.generateNonce = generateNonce;
exports.makeHttpRequest = makeHttpRequest;
const web3_js_1 = require("@solana/web3.js");
const errors_1 = require("./errors");
function isValidSolanaAddress(address) {
    try {
        new web3_js_1.PublicKey(address);
        return true;
    }
    catch {
        return false;
    }
}
function validateSolanaAddress(address) {
    if (!isValidSolanaAddress(address)) {
        throw new errors_1.InvalidAddressError(address);
    }
}
function generateNonce() {
    return Math.floor(Date.now() / 1000);
}
async function makeHttpRequest(url, method, apiKey, body, debug = false) {
    const headers = {
        'Content-Type': 'application/json',
    };
    if (apiKey) {
        headers['X-API-Key'] = apiKey;
    }
    const options = {
        method,
        headers,
    };
    if (body) {
        options.body = JSON.stringify(body);
    }
    if (debug) {
        console.log(`[ShadowWire SDK] ${method} ${url}`);
        if (body) {
            console.log('[ShadowWire SDK] Request body:', body);
        }
    }
    try {
        const response = await globalThis.fetch(url, options);
        if (!response.ok) {
            const errorText = await response.text();
            let errorMessage;
            try {
                const errorJson = JSON.parse(errorText);
                errorMessage = errorJson.error || errorJson.message || `HTTP ${response.status}: ${response.statusText}`;
            }
            catch {
                errorMessage = errorText || `HTTP ${response.status}: ${response.statusText}`;
            }
            throw new errors_1.NetworkError(errorMessage);
        }
        const data = await response.json();
        if (debug) {
            console.log('[ShadowWire SDK] Response:', data);
        }
        return data;
    }
    catch (error) {
        if (error instanceof errors_1.NetworkError) {
            throw error;
        }
        if (error instanceof Error) {
            throw new errors_1.NetworkError(`Request failed: ${error.message}`);
        }
        throw new errors_1.NetworkError('Request failed with unknown error');
    }
}
//# sourceMappingURL=utils.js.map